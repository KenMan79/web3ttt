<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>04 - Working with a Local Blockchain - Web3 Teacher Training Track</title>
  <meta name="viewport" content="width=device-width, initial-scale=1">
  
  <link rel="icon" href="https://web3.courses/favicon.ico">
  <link rel="apple-touch-icon" sizes="57x57" href="/apple-icon-57x57.png">
  <link rel="apple-touch-icon" sizes="60x60" href="/apple-icon-60x60.png">
  <link rel="apple-touch-icon" sizes="72x72" href="/apple-icon-72x72.png">
  <link rel="apple-touch-icon" sizes="76x76" href="/apple-icon-76x76.png">
  <link rel="apple-touch-icon" sizes="114x114" href="/apple-icon-114x114.png">
  <link rel="apple-touch-icon" sizes="120x120" href="/apple-icon-120x120.png">
  <link rel="apple-touch-icon" sizes="144x144" href="/apple-icon-144x144.png">
  <link rel="apple-touch-icon" sizes="152x152" href="/apple-icon-152x152.png">
  <link rel="apple-touch-icon" sizes="180x180" href="/apple-icon-180x180.png">
  <link rel="icon" type="image/png" sizes="192x192"  href="/android-icon-192x192.png">
  <link rel="icon" type="image/png" sizes="32x32" href="/favicon-32x32.png">
  <link rel="icon" type="image/png" sizes="96x96" href="/favicon-96x96.png">
  <link rel="icon" type="image/png" sizes="16x16" href="/favicon-16x16.png">
  <link rel="manifest" href="/manifest.json">
  <meta name="msapplication-TileColor" content="#ffffff">
  <meta name="msapplication-TileImage" content="/ms-icon-144x144.png">
  <meta name="theme-color" content="#ffffff">


  
  
  <link rel="stylesheet" href="/css/style.min.de51ca4f6ab4c92a5133107c1f239b77f358b8b20a1402ab9ec937cc5e4b3f0e.css">
  

  
  


</head>

<body class='page page-default-single'>
  <header class="header">
  <div class="header__logo">
    <a href="https://web3.courses/"><img alt="Logo" src="/images/icon.png" /></a>
  </div>
  <ul id="main-menu" class="main-menu">
  
  
  <li class="main-menu__item menu-item-home">
    <a class="main-menu__link" href="/">Home</a>
  </li>
  
  <li class="main-menu__item menu-item-course">
    <a class="main-menu__link" href="/teacher-training-track">Course</a>
  </li>
  
  <li class="main-menu__item menu-item-apply">
    <a class="main-menu__link" href="/apply"target="_blank">Apply</a>
  </li>
  
</ul>

</header>


  
  
    
      
    
  

  <div class="center-wrapper">
    <div class="wrapper">
      
        
<aside class="sidebar">
  <h4 class="sidebar__header">Teacher Training Track</h4>
  <ul class="sidebar__list">
    
    <li class="sidebar__item">
      <a class="sidebar__link" href="https://web3.courses/teacher-training-track/syllabus/">Syllabus</a>
    </li>
    
    <li class="sidebar__item">
      <a class="sidebar__link" href="https://web3.courses/teacher-training-track/calendar/">Calendar</a>
    </li>
    
    <li class="sidebar__item">
      <a class="sidebar__link" href="https://web3.courses/teacher-training-track/useful-information/">Useful Information</a>
    </li>
    
    <li class="sidebar__item">
      <a class="sidebar__link" href="https://web3.courses/teacher-training-track/lesson-plan/">Lesson Plan</a>
    </li>
    
    <li class="sidebar__item">
      <a class="sidebar__link" href="https://web3.courses/teacher-training-track/01-intro-blockchain-smart-contracts/">01 - Intro to Blockchain &amp; Smart Contracts</a>
    </li>
    
    <li class="sidebar__item">
      <a class="sidebar__link" href="https://web3.courses/teacher-training-track/02-exploring-smart-contracts/">02 - Exploring Smart Contracts</a>
    </li>
    
    <li class="sidebar__item">
      <a class="sidebar__link" href="https://web3.courses/teacher-training-track/03-writing-smart-contracts-solidity/">03 - Writing Smart Contracts in Solidity</a>
    </li>
    
    <li class="sidebar__item sidebar__item--active">
      <a class="sidebar__link" href="https://web3.courses/teacher-training-track/04-working-with-local-blockchain/">04 - Working with a Local Blockchain</a>
    </li>
    
    <li class="sidebar__item">
      <a class="sidebar__link" href="https://web3.courses/teacher-training-track/05-connecting-to-web-apps/">05 - Connecting to Web Apps</a>
    </li>
    
    <li class="sidebar__item">
      <a class="sidebar__link" href="https://web3.courses/teacher-training-track/06-deploying-to-testnet/">06 - Deploying to Testnet</a>
    </li>
    
  </ul>
  
    <h4 class="sidebar__header">Outline</h4>
    <nav id="TableOfContents">
  <ul>
    <li><a href="#set-up">Set up</a>
      <ul>
        <li><a href="#install-a-local-server">Install a local server</a></li>
        <li><a href="#install-metamask">Install MetaMask</a></li>
        <li><a href="#install-nodejs">Install Node.js</a></li>
        <li><a href="#install-truffle-cli">Install Truffle CLI</a></li>
        <li><a href="#install-updated-solidity-compiler">Install updated Solidity compiler</a></li>
      </ul>
    </li>
    <li><a href="#start-your-blockchain">Start your blockchain</a></li>
    <li><a href="#prepare-a-contract-to-deploy">Prepare a contract to deploy</a></li>
    <li><a href="#deploy-using-remix">Deploy using Remix</a>
      <ul>
        <li><a href="#injected-web3">Injected Web3</a></li>
        <li><a href="#web3-provider">Web3 Provider</a></li>
      </ul>
    </li>
    <li><a href="#deploy-from-local-project">Deploy from local project</a>
      <ul>
        <li><a href="#truffle-suite">Truffle Suite</a></li>
        <li><a href="#local-geth-testnet">Local geth testnet</a></li>
      </ul>
    </li>
    <li><a href="#project-status-update">Project Status Update</a></li>
  </ul>
</nav>
  
  
  
  
    <h4 class="sidebar__header">Lesson Material</h4>
    <ul class="sidebar__list">
      <li class="sidebar__item">
        <a class="sidebar__link" target="_blank" href="/teacher-training-track/04-working-with-local-blockchain/slides.html">Slides</a>
      </li>
    </ul>
  
</aside>

      

      <main class="content">
        
  <h1 class="title">04 - Working with a Local Blockchain</h1>
  <div class="content ">
    <h2 id="set-up">Set up</h2>
<h3 id="install-a-local-server">Install a local server</h3>
<p><a href="https://www.trufflesuite.com/ganache">Ganache</a> is a great GUI for quickly spinning up an easily usable local blockchain in just a few clicks. <strong>This is the recommended route for this course</strong>, since we won&rsquo;t be able to spend a lot of time helping everyone get a more complicated solution up and running. Feel free to explore the other solutions if you&rsquo;re feeling adventurous.</p>
<p>If you want to explore the <a href="https://www.trufflesuite.com/truffle">Truffle CLI</a> for yourself, it also comes with a development server.</p>
<p>Alternatively, you can download and run a full Ethereum node (<a href="https://geth.ethereum.org/">Geth</a>, <a href="https://openethereum.github.io/">OpenEthereum</a>) for your dApp development setup.</p>
<h3 id="install-metamask">Install MetaMask</h3>
<p><a href="https://metamask.io/">MetaMask</a> is a browser extension that allows websites to connect to an Ethereum network, whether mainnet, testnet, or any other RPC provider (like a local Ganache instance).</p>
<h3 id="install-nodejs">Install Node.js</h3>
<p><a href="https://nodejs.org/">Node.js</a> is a local JavaScript runtime that comes with the Node Package Manager (NPM), which we will use to install Truffle.</p>
<h3 id="install-truffle-cli">Install Truffle CLI</h3>
<p>Truffle is a suite of command-line tools for dApp development.</p>
<p>Once you have NPM installed, installing Truffle is as simple as running this command:</p>
<div class="highlight"><pre class="chroma"><code class="language-txt" data-lang="txt">$ npm install -g truffle
</code></pre></div><p>Double-check everything is working by running:</p>
<div class="highlight"><pre class="chroma"><code class="language-txt" data-lang="txt">$ truffle version
Truffle v5.3.7 (core: 5.3.7)
Solidity v0.5.16 (solc-js)
Node v14.16.1
Web3.js v1.3.6
</code></pre></div><h3 id="install-updated-solidity-compiler">Install updated Solidity compiler</h3>
<p>Truffle&rsquo;s built-in Solidity compiler isn&rsquo;t always the latest version, so let&rsquo;s install a more up-to-date one:</p>
<div class="highlight"><pre class="chroma"><code class="language-txt" data-lang="txt">$ npm install -g solc@latest
</code></pre></div><p>Double-check everything is working by running:</p>
<div class="highlight"><pre class="chroma"><code class="language-txt" data-lang="txt">$ solcjs --version
0.8.4+commit.c7e474f2.Emscripten.clang
</code></pre></div><h2 id="start-your-blockchain">Start your blockchain</h2>
<ol>
<li>Open up Ganache.</li>
</ol>
<p><img src="./ganache-init-screen.png" alt="Ganache welcome screen with quickstart button"></p>
<ol start="2">
<li>Press on the big &ldquo;Quickstart&rdquo; button.</li>
<li>Your blockchain is running!</li>
</ol>
<p><img src="./ganache-accounts-list.png" alt="Ganache running and displaying accounts list"></p>
<ol start="4">
<li>Click on the settings cog icon and go to the &ldquo;Server&rdquo; tab. Make sure the port number is set to 8545, then save and restart Ganache.</li>
</ol>
<p><img src="./ganache-server-settings.png" alt="Ganache server settings screen"></p>
<h2 id="prepare-a-contract-to-deploy">Prepare a contract to deploy</h2>
<p>You may deploy a contract you have already written, or feel free to use <a href="https://github.com/bafnetwork/web3ttt/blob/main/examples/04/contracts/PyramidScheme.sol">this one</a> as a sample.</p>
<h2 id="deploy-using-remix">Deploy using Remix</h2>
<p>Remix IDE is a surprisingly capable browser-based development environment. One of its most useful features is the ability to connect to different web3 providers.</p>
<h3 id="injected-web3">Injected Web3</h3>
<p><strong>Injected Web3</strong> refers to the way that extensions like MetaMask support web3 integration: injecting a global JavaScript object into the page that provides handles to various pieces of functionality within a selected Ethereum network.</p>
<p>MetaMask comes with a custom RPC configuration for <code>localhost:8545</code> networks by default, which makes it easier for us. If you don&rsquo;t have that configuration or would like to set up another one, use the following configuration:</p>
<p><img src="./metamask-localhost-configuration.png" alt="MetaMask custom network configuration for localhost on port 8545"></p>
<p>Select the local network configuration, then import an account from Ganache:</p>
<ol>
<li>Click on the &ldquo;Import Account&rdquo; button in MetaMask.</li>
</ol>
<p><img src="./metamask-import-account-button.png" alt="MetaMask import account button"></p>
<ol start="2">
<li>Copy the private key from any account in Ganache.</li>
</ol>
<p><img src="./ganache-show-keys-button.png" alt="Ganache &ldquo;Show Keys&rdquo; button"></p>
<ol start="3">
<li>Paste it into MetaMask and click &ldquo;Import&rdquo;.</li>
</ol>
<p><img src="./metamask-import-private-key.png" alt="MetaMask import private key"></p>
<p>Open up Remix IDE and navigate to the &ldquo;Deploy &amp; Run Transactions&rdquo; side panel.</p>
<p><img src="./remix-deploy.png" alt="Remix IDE Deploy & Run Transactions panel"></p>
<p>Choose &ldquo;Injected Web3&rdquo; from the &ldquo;Environment&rdquo; dropdown. MetaMask should open up and ask you to confirm the connection to the website.</p>
<p>Now, when contracts are deployed from Remix, instead of only existing in-browser, the contracts will actually be deployed onto your local blockchain, and you will be able to observe activity from Ganache&rsquo;s interface.</p>
<p>This approach is good to know because it is flexible: you can easily configure MetaMask to connect to any RPC network you desire, not just a local one.</p>
<h3 id="web3-provider">Web3 Provider</h3>
<p>The other way to connect Remix IDE to your local blockchain bypasses MetaMask entirely. First, ensure that the web address you&rsquo;re using to access Remix does <em>not</em> start with <code>https</code>. Then, you can select &ldquo;Web3 Provider&rdquo; from the &ldquo;Environment&rdquo; dropdown, and paste in <code>http://127.0.0.1:8545</code>, adjusting for whatever port Ganache is running on. If you plan on writing contracts in Remix using a local blockchain, this is probably a better long-term solution.</p>
<h2 id="deploy-from-local-project">Deploy from local project</h2>
<h3 id="truffle-suite">Truffle Suite</h3>
<p>If you don&rsquo;t wish to write and test your contracts in Remix, you can use the Truffle Console to connect to Ganache locally, allowing you to use the editor of your choice in your development. Truffle Console (or Truffle Develop) is our recommended development setup for large or long-term projects. However, it requires a bit of configuration and doesn&rsquo;t provide GUIs to help you along. You can find our example Truffle project <a href="https://github.com/bafnetwork/web3ttt/tree/main/examples/04">here</a> and customize it to fit your needs. Otherwise, you can run <code>truffle init</code> in an empty directory to start from scratch.</p>
<p>The first thing to do is make sure that your <code>truffle-config.js</code> file knows how to connect to your local blockchain instance. Find the bit of code that looks like this and add your connection information.</p>
<div class="highlight"><pre class="chroma"><code class="language-js" data-lang="js"><span class="nx">development</span><span class="o">:</span> <span class="p">{</span>
  <span class="nx">host</span><span class="o">:</span> <span class="s1">&#39;127.0.0.1&#39;</span><span class="p">,</span>
  <span class="nx">port</span><span class="o">:</span> <span class="mi">8545</span><span class="p">,</span>
  <span class="nx">network_id</span><span class="o">:</span> <span class="s1">&#39;*&#39;</span><span class="p">,</span>
<span class="p">},</span>
</code></pre></div><p>Also find the section that looks like this and add the version of Solidity you want to use:</p>
<div class="highlight"><pre class="chroma"><code class="language-js" data-lang="js"><span class="nx">compilers</span><span class="o">:</span> <span class="p">{</span>
  <span class="nx">solc</span><span class="o">:</span> <span class="p">{</span>
    <span class="nx">version</span><span class="o">:</span> <span class="s1">&#39;0.8.4&#39;</span><span class="p">,</span>
</code></pre></div><p>Now you should be able to run <code>truffle console</code> from the same directory as <code>truffle-config.js</code> and receive a prompt connected to the blockchain from which you can deploy and manage your project during development.</p>
<div class="highlight"><pre class="chroma"><code class="language-txt" data-lang="txt">$ truffle console
truffle(development)&gt;
</code></pre></div><p>This acts pretty much like a JavaScript REPL<sup id="fnref:1"><a href="#fn:1" class="footnote-ref" role="doc-noteref">1</a></sup> with Truffle, Web3 utilities, and proxies to your compiled contracts in scope, along with a few extra commands. Here&rsquo;s a useful selection:</p>
<ul>
<li><code>compile</code> compiles all of your contracts</li>
<li><code>migrate</code> runs any new migrations that haven&rsquo;t been run yet</li>
<li><code>migrate --reset</code> runs all of the migrations in order from the beginning</li>
<li><code>test &lt;path-to-test-script&gt;</code> runs a test (keep your tests in the <code>test/</code> directory)</li>
</ul>
<p>This setup is pretty friendly to test-driven development (which is a great paradigm for writing smart contracts). <a href="https://github.com/bafnetwork/web3ttt/blob/main/examples/04/test/PyramidScheme.test.js">Check out the sample test</a>.</p>
<p>In the Truffle Console, your compiled contracts will be available, and if they have been deployed by the migrations scripts, you can grab an instance of the deployed contract by writing something like the following:</p>
<div class="highlight"><pre class="chroma"><code class="language-js" data-lang="js"><span class="kd">let</span> <span class="nx">instance</span> <span class="o">=</span> <span class="kr">await</span> <span class="nx">MyContract</span><span class="p">.</span><span class="nx">deployed</span><span class="p">();</span>
</code></pre></div><p>You can interact with the contract using the <code>instance</code> variable.</p>
<p>To call view methods:</p>
<div class="highlight"><pre class="chroma"><code class="language-js" data-lang="js"><span class="nx">instance</span><span class="p">.</span><span class="nx">myViewMethod</span><span class="p">.</span><span class="nx">call</span><span class="p">(</span><span class="nx">param1</span><span class="p">,</span> <span class="nx">param2</span><span class="p">,</span> <span class="p">{</span>
  <span class="nx">from</span><span class="o">:</span> <span class="s1">&#39;0xADDRESS&#39;</span><span class="p">,</span>
<span class="p">});</span>
</code></pre></div><p>To run transactions:</p>
<div class="highlight"><pre class="chroma"><code class="language-js" data-lang="js"><span class="nx">instance</span><span class="p">.</span><span class="nx">myFunction</span><span class="p">(</span><span class="nx">param1</span><span class="p">,</span> <span class="nx">param2</span><span class="p">,</span> <span class="p">{</span>
  <span class="nx">from</span><span class="o">:</span> <span class="s1">&#39;0xADDRESS&#39;</span><span class="p">,</span>
  <span class="nx">value</span><span class="o">:</span> <span class="nx">web3</span><span class="p">.</span><span class="nx">utils</span><span class="p">.</span><span class="nx">toWei</span><span class="p">(</span><span class="s1">&#39;1&#39;</span><span class="p">,</span> <span class="s1">&#39;ether&#39;</span><span class="p">),</span>
  <span class="nx">gas</span><span class="o">:</span> <span class="s1">&#39;300000&#39;</span><span class="p">,</span>
  <span class="nx">gasPrice</span><span class="o">:</span> <span class="nx">web3</span><span class="p">.</span><span class="nx">utils</span><span class="p">.</span><span class="nx">toWei</span><span class="p">(</span><span class="s1">&#39;20&#39;</span><span class="p">,</span> <span class="s1">&#39;gwei&#39;</span><span class="p">),</span>
<span class="p">});</span>
</code></pre></div><p>The configuration object and its properties (everything in <code>{</code> curly braces <code>}</code>) are optional for both view and transaction calls, so you only need to include them if the call requires them.</p>
<h3 id="local-geth-testnet">Local geth testnet</h3>
<p>Although we won&rsquo;t go over this method in detail in this course, we encourage you to at least read a little about how geth works. This is an excellent two-part guide that will get you up-and-running with a local geth testnet instance. (If you installed the Solidity compiler as described <a href="#install-updated-solidity-compiler">above</a>, the executable is called <code>solcjs</code> instead of just <code>solc</code>.)</p>
<ul>
<li>Part 1: <a href="https://arvanaghi.com/blog/how-to-set-up-a-private-ethereum-blockchain-using-geth/">How to Set Up a Private Ethereum Blockchain using Geth</a></li>
<li>Part 2: <a href="https://arvanaghi.com/blog/testing-smart-contracts-on-a-private-blockchain-with-Geth/">Testing Smart Contracts Locally using Geth</a></li>
</ul>
<h2 id="project-status-update">Project Status Update</h2>
<p>Put the finishing touches on your smart contract, and then write some tests for it! You can use whatever development setup you want. Don&rsquo;t forget to emit any events you may need to listen for, since we&rsquo;re going to be writing the web app next!</p>
<section class="footnotes" role="doc-endnotes">
<hr>
<ol>
<li id="fn:1" role="doc-endnote">
<p><strong>R</strong>ead <strong>E</strong>val <strong>P</strong>rint <strong>L</strong>oop&#160;<a href="#fnref:1" class="footnote-backref" role="doc-backlink">&#x21a9;&#xfe0e;</a></p>
</li>
</ol>
</section>

  </div>

      </main>
    </div>
  </div>

  

  
  


  
  <script type="text/javascript" src="/js/scripts.min.e3b0c44298fc1c149afbf4c8996fb92427ae41e4649b934ca495991b7852b855.js"></script>
  

  
  
  
    
  


</body>

</html>
